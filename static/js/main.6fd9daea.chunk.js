(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{203:function(e,t,a){e.exports=a(441)},440:function(e,t,a){},441:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(15),i=a.n(s),o=a(3),c=a(5),l=a(4),u=a(7),d=a(2),h=a(6),p=a(1),m=a.n(p),f=a(16),g=a(10),v=a.n(g),b=a(47),S=a(24),y=a.n(S),E=a(191),w="https://api.secret-in.me";"undefined"!==typeof window.process&&(w=new URLSearchParams(window.location.search).get("api"));var C=new y.a(E.SecretinBrowserAdapter,y.a.API.Server,w),k=Object(b.a)({},y.a.Statuses),O=Object(b.a)({},y.a.Errors),j=C,U=a(128),F=a.n(U),T=new F.a({batchingFunction:i.a.unstable_batchedUpdates});F.a.debug("alt",T);var N=T,P=k.DecryptMetadataStatus,R=k.EndDecryptMetadataStatus,I=k.DecryptUserOptionsStatus,A=k.DecryptMetadataCacheStatus,L=O.UsernameAlreadyExistsError,M=O.UserNotFoundError,D=O.InvalidPasswordError,_=O.NeedTOTPTokenError,z=function(){function e(){Object(o.a)(this,e),this.generateActions("createUserSuccess","createUserFailure","loginUserSuccess","loginUserFailure","appReady","connectionChange")}return Object(d.a)(e,[{key:"disconnectUser",value:function(){return function(e){e(),j.currentUser.disconnect()}}},{key:"createUser",value:function(e){var t=this,a=e.username,n=e.password,r=e.confirmPassword;return function(e){e(),n!==r?setTimeout(function(){return t.createUserFailure({error:{confirmPassword:"Passwords mismatch"}})},100):j.newUser(a,n).then(function(e){return t.createUserSuccess({currentUser:e})}).catch(function(e){if(e instanceof L)return t.createUserFailure({error:{username:"User already exists"}});throw e})}}},{key:"loginUser",value:function(e){var t=this,a=e.username,n=e.password,r=e.token;return function(e){e(),j.loginUser(a,n,r,t.loginUserProgress,!1).then(function(e){return t.loginUserSuccess({currentUser:e,options:Object(b.a)({},e.options,{totp:e.totp,shortLogin:j.canITryShortLogin()}),metadata:e.metadatas})}).catch(function(e){if(e instanceof M)return t.loginUserFailure({error:{username:"User not found"}});if(e instanceof D)return r?t.loginUserFailure({error:{totp:"Token",password:"Invalid password",token:"or invalid token"}}):t.loginUserFailure({error:{password:"Invalid password"}});if(e instanceof _)return t.loginUserFailure({error:{totp:"Token"}});throw e})}}},{key:"loginUserProgress",value:function(e){var t=this;return function(a){var n=j.currentUser;switch(e.constructor){case A:case P:return a({status:e});case I:return a({status:e,currentUser:n});case R:return t.loginUserSuccess({currentUser:n,options:Object(b.a)({},n.options,{totp:n.totp,shortLogin:j.canITryShortLogin()}),metadata:n.metadatas}),a({status:null});default:return}}}},{key:"shortLogin",value:function(e){var t=this,a=e.shortpass;return function(e){e(),j.shortLogin(a,t.loginUserProgress,!1).then(function(e){t.loginUserSuccess({currentUser:e,options:Object(b.a)({},e.options,{totp:e.totp,shortLogin:j.canITryShortLogin()}),metadata:e.metadatas})}).catch(function(){return t.loginUserFailure({error:{shortlogin:"Invalid shortpass"}})})}}},{key:"disableShortLogin",value:function(){return function(e){e(),j.deactivateShortLogin()}}}]),e}(),x=N.createActions(z);function B(e){var t=e;return t.config={setState:function(e,t){return this.state=t,this.state},getState:function(e){return e.state||e},onSerialize:function(e){return(e.state||e).toJS()},onDeserialize:function(e){return m.a.fromJS(e)}},t}var H=O.FriendNotFoundError,G=function(){function e(){Object(o.a)(this,e),this.generateActions("loadMetadataSuccess","createSecretSuccess","createSecretFailure","updateSecretSuccess","updateSecretFailure","renameSecretSuccess","renameSecretFailure","deleteSecretSuccess","deleteSecretFailure","createSecretUserRightsSuccess","createSecretUserRightsFailure","updateSecretUserRightsSuccess","updateSecretUserRightsFailure","deleteSecretUserRightsSuccess","deleteSecretUserRightsFailure","removeSecretFromCurrentFolderSuccess","removeSecretFromCurrentFolderFailure","addSecretToFolderSuccess","addSecretToFolderFailure")}return Object(d.a)(e,[{key:"loadMetadata",value:function(){var e=this;return function(t){t(),j.refreshUser().then(function(){e.loadMetadataSuccess({metadata:j.currentUser.metadatas})})}}},{key:"createSecret",value:function(){var e,t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{isFolder:!1},n=a.title,r=a.data,s=a.folder,i=a.isFolder;return e=i?s?j.addFolder(n,s):j.addFolder(n):s?j.addSecret(n,r.toJS(),s):j.addSecret(n,r.toJS()),function(a){a(),e.then(function(){return t.createSecretSuccess({metadata:j.currentUser.metadatas})}).catch(function(e){throw t.createSecretFailure({error:e}),e})}}},{key:"updateSecret",value:function(e){var t=this,a=e.secret,n=e.data;return function(e){e(),j.editSecret(a.id,n).then(function(){t.updateSecretSuccess({metadata:j.currentUser.metadatas,data:n})}).catch(function(e){throw t.updateSecretFailure({error:e}),e})}}},{key:"renameSecret",value:function(e){var t=this,a=e.secret,n=e.newTitle;return function(e){e(),j.renameSecret(a.id,n).then(function(){t.renameSecretSuccess({metadata:j.currentUser.metadatas})}).catch(function(e){throw t.renameSecretFailure({error:e}),e})}}},{key:"deleteSecret",value:function(e){var t=this,a=e.secret;return function(e){e(),j.deleteSecret(a.id).catch(function(e){throw t.deleteSecretFailure({metadata:j.currentUser.metadatas}),e}).then(function(){return t.deleteSecretSuccess({metadata:j.currentUser.metadatas})})}}},{key:"createSecretUserRights",value:function(e){var t=this,a=e.secret,n=e.user,r=e.rights;return function(e){e(),j.shareSecret(a.id,n.username,r).then(function(){return j.refreshUser()}).then(function(){t.createSecretUserRightsSuccess({metadata:j.currentUser.metadatas})}).catch(function(e){if(e instanceof H)return t.createSecretUserRightsFailure({error:{username:"User not found"}});throw t.createSecretUserRightsFailure({error:{unknown:"Unknown error"}}),e})}}},{key:"updateSecretUserRights",value:function(e){var t=this,a=e.secret,n=e.user,r=e.rights;return function(e){e(),j.shareSecret(a.id,n.username,r).then(function(){return t.updateSecretUserRightsSuccess({secret:a,user:n,rights:r})}).catch(function(e){throw t.updateSecretUserRightsFailure({error:{unknown:"Unknown error"}}),e})}}},{key:"deleteSecretUserRights",value:function(e){var t=this,a=e.secret,n=e.user;return function(e){e(),j.unshareSecret(a.id,n.username).then(function(){return t.deleteSecretUserRightsSuccess({secret:a,user:n})}).catch(function(e){throw t.deleteSecretUserRightsFailure({error:{unknown:"Unknown error"}}),e})}}},{key:"addSecretToFolder",value:function(e){var t=this,a=e.secret,n=e.folder;return function(e){e(),j.addSecretToFolder(a.id,n.id).then(function(){return t.addSecretToFolderSuccess({secret:a,folder:n,metadata:j.currentUser.metadatas})}).catch(function(e){throw t.addSecretToFolderFailure({error:{unknown:"Unknown error"}}),e})}}},{key:"removeSecretFromCurrentFolder",value:function(e){var t=this,a=e.secret,n=e.currentFolderId;return function(e){e(),j.removeSecretFromFolder(a.id,n).then(function(){return t.removeSecretFromCurrentFolderSuccess({secret:a,currentFolderId:n,metadata:j.currentUser.metadatas})}).catch(function(e){throw t.removeSecretFromCurrentFolderFailure({error:{unknown:"Unknown error"}}),e})}}}]),e}(),Q=N.createActions(G),K=new p.Record({savedUsername:"",loading:!1,connected:!1,online:!0,errors:new m.a.Map,currentUser:null,status:null}),J=function(){function e(){Object(o.a)(this,e),this.bindActions(x),this.bindAction(Q.CREATE_SECRET,this.loading),this.bindAction(Q.CREATE_SECRET_SUCCESS,this.endLoading),this.bindAction(Q.CREATE_SECRET_FAILURE,this.endLoading),this.state=new K({savedUsername:j.getSavedUsername()})}return Object(d.a)(e,[{key:"loading",value:function(){this.setState(this.state.merge({loading:!0}))}},{key:"endLoading",value:function(){this.setState(this.state.merge({loading:!1}))}},{key:"onConnectionChange",value:function(e){var t=e.connection;this.setState(this.state.merge({online:"online"===t}))}},{key:"onCreateUser",value:function(){this.setState(this.state.merge({loading:!0}))}},{key:"onDisconnectUser",value:function(){this.setState(this.state.merge({savedUsername:j.getSavedUsername(),loading:!1,connected:!1,errors:new m.a.Map,currentUser:null}))}},{key:"onCreateUserSuccess",value:function(e){var t=e.currentUser;this.setState(this.state.merge({loading:!1,connected:!0,errors:new m.a.Map,currentUser:t}))}},{key:"onCreateUserFailure",value:function(e){var t=e.error;this.setState(this.state.merge({loading:!1,connected:!1,errors:new m.a.Map(t),status:null}))}},{key:"onLoginUser",value:function(){this.setState(this.state.merge({loading:!0}))}},{key:"onShortLogin",value:function(){this.setState(this.state.merge({loading:!0}))}},{key:"onLoginUserProgress",value:function(e){var t=e.status,a=e.currentUser;a?this.setState(this.state.merge({status:t,connected:!0,currentUser:a})):this.setState(this.state.set("status",t))}},{key:"onLoginUserSuccess",value:function(e){var t=e.currentUser;this.setState(this.state.merge({loading:!1,connected:!0,errors:new m.a.Map,status:null,currentUser:t}))}},{key:"onLoginUserFailure",value:function(e){var t=e.error;this.setState(this.state.merge({loading:!1,connected:!1,errors:new m.a.Map(t),status:null}))}}],[{key:"isLoading",value:function(){return this.getState().get("loading")}},{key:"getCurrentUser",value:function(){return this.getState().get("currentUser")}},{key:"isOnline",value:function(){return this.getState().get("online")}}]),e}(),q=N.createStore(B(J),"AppUIStore"),Y=a(27),W=a.n(Y),V=function(){function e(){Object(o.a)(this,e),this.generateActions("deactivateTotpSuccess","deactivateTotpFailure","activateTotpSuccess","activateTotpFailure","activateShortLoginSuccess","activateShortLoginFailure","deactivateShortLoginSuccess","deactivateShortLoginFailure","showImportKeepass","hideImportKeepass","showChangePassword","hideChangePassword","importKeepassProgress","importKeepassSuccess","importKeepassFailure","hideQRCode","hideShortLogin","changeDelaySuccess","changeDelayFailure","showRescueCodesSuccess","hideRescueCodes","changeNewPass1","changeNewPass2","changePasswordSuccess","changePasswordFailure")}return Object(d.a)(e,[{key:"deactivateTotp",value:function(){var e=this;return function(t){t(),j.deactivateTotp().then(function(){e.deactivateTotpSuccess()}).catch(function(){e.deactivateTotpFailure()})}}},{key:"activateTotp",value:function(e){var t=this,a=e.seed,n=e.token;return function(e){e(),j.api.testTotp(a.b32,n).then(function(){return j.activateTotp(a)}).then(function(){t.activateTotpSuccess()}).catch(function(e){"Invalid couple"===e?t.activateTotpFailure({error:"Synchronisation error"}):t.activateTotpFailure({error:"An error occured"})})}}},{key:"activateShortLogin",value:function(e){var t=this,a=e.shortpass;return function(e){e(),j.activateShortLogin(a,W.a.v4()).then(function(){t.activateShortLoginSuccess({shortLogin:j.canITryShortLogin()})}).catch(function(){t.activateShortLoginFailure()})}}},{key:"deactivateShortLogin",value:function(){var e=this;return function(t){t(),j.deactivateShortLogin().then(function(){e.deactivateShortLoginSuccess({shortLogin:j.canITryShortLogin()})}).catch(function(){e.deactivateShortLoginFailure()})}}},{key:"changePassword",value:function(e){var t=this,a=e.newPass;return function(e){e(),j.changePassword(a).then(function(){t.changePasswordSuccess()}).catch(function(){t.changePasswordFailure()})}}},{key:"toggleTotp",value:function(e){return!!e.checked||this.deactivateTotp()}},{key:"showRescueCodes",value:function(){var e=this;return function(t){t(),window.confirm("Be careful, this will replace your previously generated codes. Continue?")&&j.getRescueCodes().then(function(t){e.showRescueCodesSuccess({rescueCodes:t})})}}},{key:"toggleShortLogin",value:function(e){return!!e.checked||this.deactivateShortLogin()}},{key:"toggleAutoLogout",value:function(e){var t=e.checked?30:0;return this.changeTimeToClose({timeToClose:t})}},{key:"changeTimeToClose",value:function(e){var t=this,a=e.timeToClose;return j.editOption("timeToClose",a).then(function(){t.changeDelaySuccess({timeToClose:a})}).catch(function(){t.changeDelayFailure()}),!0}}]),e}(),$=N.createActions(V),X=new p.Record({options:new m.a.Map,errors:new m.a.Map,showQRCode:!1,showShortLogin:!1,showRescueCodes:!1,newPass:new m.a.Map({shown:!1,newPass1:"",newPass2:"",error:"",loading:!1,status:"initial"}),rescueCodes:new m.a.List,loading:!1}),Z=function(){function e(){Object(o.a)(this,e),this.bindAction(x.LOGIN_USER_SUCCESS,this.onLoadOptions),this.bindActions($),this.state=new X}return Object(d.a)(e,[{key:"onLoadOptions",value:function(e){var t=e.options;this.setState(this.state.set("options",new m.a.Map(t)))}},{key:"onActivateTotp",value:function(){this.setState(this.state.set("loading",!0))}},{key:"onActivateShortLogin",value:function(){this.setState(this.state.set("loading",!0))}},{key:"onToggleTotp",value:function(e){this.setState(this.state.set("showQRCode",e))}},{key:"onToggleShortLogin",value:function(e){this.setState(this.state.set("showShortLogin",e))}},{key:"onActivateTotpFailure",value:function(e){var t=e.error;this.setState(this.state.merge({errors:new m.a.Map({totp:t}),loading:!1}))}},{key:"onHideQRCode",value:function(){this.setState(this.state.merge({showQRCode:!1,loading:!1,errors:new m.a.Map}))}},{key:"onHideShortLogin",value:function(){this.setState(this.state.merge({showShortLogin:!1,loading:!1,errors:new m.a.Map}))}},{key:"onActivateTotpSuccess",value:function(){this.setState(this.state.merge({showQRCode:!1,loading:!1,errors:new m.a.Map}).setIn(["options","totp"],!0))}},{key:"onDeactivateTotpSuccess",value:function(){this.setState(this.state.setIn(["options","totp"],!1))}},{key:"onDeactivateShortLoginSuccess",value:function(e){var t=e.shortLogin;this.setState(this.state.setIn(["options","shortLogin"],t))}},{key:"onActivateShortLoginSuccess",value:function(e){var t=e.shortLogin;this.setState(this.state.merge({showShortLogin:!1,loading:!1,errors:new m.a.Map}).setIn(["options","shortLogin"],t))}},{key:"onChangeDelaySuccess",value:function(e){var t=e.timeToClose;this.setState(this.state.setIn(["options","timeToClose"],t))}},{key:"onChangeNewPass1",value:function(e){this.setState(this.state.setIn(["newPass","newPass1"],e.value))}},{key:"onChangeNewPass2",value:function(e){this.setState(this.state.setIn(["newPass","newPass2"],e.value))}},{key:"onShowChangePassword",value:function(){this.setState(this.state.setIn(["newPass","newPass1"],"").setIn(["newPass","newPass2"],"").setIn(["newPass","error"],"").setIn(["newPass","loading"],!1).setIn(["newPass","shown"],!0))}},{key:"onHideChangePassword",value:function(){this.setState(this.state.setIn(["newPass","newPass1"],"").setIn(["newPass","newPass2"],"").setIn(["newPass","error"],"").setIn(["newPass","loading"],!1).setIn(["newPass","shown"],!1))}},{key:"onChangePassword",value:function(){this.setState(this.state.setIn(["newPass","loading"],!0).setIn(["newPass","error"],""))}},{key:"onChangePasswordSuccess",value:function(){this.setState(this.state.setIn(["newPass","newPass1"],"").setIn(["newPass","newPass2"],"").setIn(["newPass","error"],"").setIn(["newPass","loading"],!1).setIn(["newPass","status"],"success"))}},{key:"onChangePasswordFailure",value:function(){this.setState(this.state.setIn(["newPass","error"],"Password change failed").setIn(["newPass","loading"],!1).setIn(["newPass","status"],"failure"))}},{key:"onShowRescueCodesSuccess",value:function(e){var t=e.rescueCodes;this.setState(this.state.merge({rescueCodes:new m.a.List(t),showRescueCodes:!0}))}},{key:"onHideRescueCodes",value:function(){this.setState(this.state.merge({rescueCodes:new m.a.List,showRescueCodes:!1}))}}],[{key:"getOptions",value:function(){return this.getState().get("options")}},{key:"getNewPass",value:function(){return this.getState().get("newPass")}}]),e}(),ee=N.createStore(B(Z),"OptionsStore"),te=a(39),ae=a.n(te),ne={id:null,username:null,rights:null,folders:new m.a.Map},re=new m.a.List([0,1,2]);function se(e){switch(e){case 0:return"Read only";case 1:return"Read and write";case 2:return"Read, write and share";default:throw new Error('Unknown access rights "'.concat(e,'"'))}}var ie=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new m.a.Map;return Object(o.a)(this,t),Object(c.a)(this,Object(l.a)(t).call(this,e.set("id",e.get("username",W.a.v4()))))}return Object(h.a)(t,e),Object(d.a)(t,[{key:"isValid",value:function(){return this.username.length>0}}],[{key:"createFromRaw",value:function(e){return new t(m.a.fromJS(e).map(function(e,t){switch(t){case"folders":return m.a.fromJS(e);default:return e}}))}}]),t}(new m.a.Record(ne)),oe=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new m.a.Map;return Object(o.a)(this,t),Object(c.a)(this,Object(l.a)(t).call(this,e.set("id",e.get("id",W.a.v4()))))}return Object(h.a)(t,e),Object(d.a)(t,null,[{key:"createFromRaw",value:function(e){return new t(m.a.fromJS(e).mapKeys(function(e){switch(e){case"value":return"content";default:return e}}))}}]),t}(new m.a.Record({id:null,date:null,type:"text",label:"",content:""})),ce={type:"default",fields:new m.a.List},le=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(d.a)(t,[{key:"addNewField",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new m.a.Map;return this.update("fields",function(t){return t.push(new oe(e))})}}],[{key:"createWithDefaultFields",value:function(e){return e.reduce(function(e,t){return e.addNewField(t)},new t)}},{key:"createFromRaw",value:function(e){return new t(m.a.fromJS(e).map(function(e,t){switch(t){case"fields":return e.map(function(e){return oe.createFromRaw(e)}).toList();default:return e}}))}}]),t}(new m.a.Record(ce));le.DEFAULT_FIELDS=new m.a.List([new m.a.Map({label:"login",type:"text"}),new m.a.Map({label:"password",type:"password"}),new m.a.Map({label:"url",type:"url"})]);var ue=le,de={id:null,type:null,title:null,lastModifiedBy:null,lastModifiedAt:null,users:new m.a.Map,data:null},he=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(d.a)(t,[{key:"getIcon",value:function(){switch(this.type){case"folder":return this.users.size>1?"folder-shared":"folder";case"secret":return"description";case"windows":return"windows";default:return"description"}}},{key:"accessRightForUser",value:function(e){return this.users.get(e.username).get("rights")}},{key:"canBeReadBy",value:function(e){return this.accessRightForUser(e)>=0}},{key:"canBeUpdatedBy",value:function(e){return this.accessRightForUser(e)>=1}},{key:"canBeSharedBy",value:function(e){return this.accessRightForUser(e)>=2}},{key:"canBeDeleted",value:function(){return"windows"!==this.type}}],[{key:"createFromRaw",value:function(e){return new t(m.a.fromJS(e).map(function(e,t){switch(t){case"users":return e.map(function(e){return ie.createFromRaw(e)});case"data":return ue.createFromRaw(e);case"lastModifiedAt":return ae()(e);default:return e}}))}}]),t}(new m.a.Record(de)),pe=new p.Record({metadata:new m.a.Map});function me(e){return m.a.fromJS(e).map(function(e){return he.createFromRaw(e)})}var fe=function(){function e(){Object(o.a)(this,e),this.bindAction(x.LOGIN_USER_SUCCESS,this.onLoadMetadataSuccess),this.bindActions(Q),this.state=new pe}return Object(d.a)(e,[{key:"onLoadMetadataSuccess",value:function(e){var t=e.metadata;this.setState(this.state.set("metadata",me(t)))}},{key:"onCreateSecretSuccess",value:function(e){var t=e.metadata;this.setState(this.state.set("metadata",me(t)))}},{key:"onDeleteSecretSuccess",value:function(e){var t=e.metadata;this.setState(this.state.set("metadata",me(t)))}},{key:"onDeleteSecretFailure",value:function(e){var t=e.metadata;this.setState(this.state.set("metadata",me(t)))}},{key:"onAddSecretToFolderSuccess",value:function(e){var t=e.metadata;this.setState(this.state.set("metadata",me(t)))}},{key:"onRemoveSecretFromCurrentFolderSuccess",value:function(e){var t=e.metadata;this.setState(this.state.set("metadata",me(t)))}},{key:"onCreateSecretUserRightsSuccess",value:function(e){var t=e.metadata;this.setState(this.state.set("metadata",me(t)))}},{key:"onUpdateSecretSuccess",value:function(e){var t=e.metadata;this.setState(this.state.set("metadata",me(t)))}},{key:"onRenameSecretSuccess",value:function(e){var t=e.metadata;this.setState(this.state.set("metadata",me(t)))}},{key:"onUpdateSecretUserRightsSuccess",value:function(e){var t=e.secret,a=e.user,n=e.rights;this.setState(this.state.updateIn(["metadata",t.id,"users"],function(e){return e.map(function(e){return e.id===a.id?e.set("rights",n):e})}))}},{key:"onDeleteSecretUserRightsSuccess",value:function(e){var t=e.secret,a=e.user;this.setState(this.state.updateIn(["metadata",t.id,"users"],function(e){return e.filterNot(function(e){return e.id===a.id})}))}}],[{key:"getById",value:function(e){var t=this.getState().metadata;return t?t.get(e):new m.a.Map}},{key:"getSecretsInFolder",value:function(e){var t=this.getState().metadata,a=q.getCurrentUser();if(!a||!t)return new m.a.Map;var n=a.username;return t.filter(function(t){return!e&&t.getIn(["users",n,"folders","ROOT"])||e&&t.getIn(["users",n,"folders",e])})}},{key:"getAllFolders",value:function(){return this.getState().metadata.filter(function(e){return"folder"===e.type})||new m.a.Map}},{key:"getAllSecrets",value:function(){return this.getState().metadata.filter(function(e){return"folder"!==e.type})||new m.a.Map}},{key:"getMySecret",value:function(){return this.getAllSecrets().filter(function(e){return 2===e.users.filter(function(e){return e.username===j.currentUser.username}).first().get("rights")})||new m.a.Map}},{key:"getSharedSecret",value:function(){return this.getAllSecrets().filter(function(e){return e.users.size>1})||new m.a.Map}}]),e}(),ge=N.createStore(B(fe),"MetadataStore"),ve=a(33),be=a(11),Se=a(8),ye=a.n(Se),Ee=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).id=e.id||Object(be.uniqueId)("form_"),a.onSubmit=a.onSubmit.bind(Object(u.a)(a)),a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"onSubmit",value:function(e){e.preventDefault(),this.props.disabled||this.props.onSubmit()}},{key:"render",value:function(){var e=ye()("form",this.props.className);return r.a.createElement("form",{id:this.id,className:e,onSubmit:this.onSubmit,autoComplete:this.props.autoComplete?null:"new-password"},!this.props.autoComplete&&[r.a.createElement("input",{key:"autofill_trap_email",name:"autofill_trap_email",type:"text",style:{display:"none"}}),r.a.createElement("input",{key:"autofill_trap_password",name:"autofill_trap_password",type:"password",style:{display:"none"}})],r.a.createElement("input",{type:"submit",style:{display:"none"}}),this.props.children)}}]),t}(n.Component);Ee.defaultProps={disabled:!1,autoComplete:!1,onSubmit:function(){return{}}};var we=Ee,Ce={small:18,base:24},ke=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props,t=e.id,a=e.size,n=ye()("icon","icon--id-".concat(t),this.props.className,Object(ve.a)({},"icon--size-".concat(a),"string"===typeof a));return r.a.createElement("svg",{className:n,width:"string"===typeof a?Ce[a]:a,height:"string"===typeof a?Ce[a]:a},r.a.createElement("use",{xlinkHref:"#".concat(t)}))}}]),t}(n.Component);ke.defaultProps={size:"base",className:""};var Oe=ke,je=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).handleClick=a.handleClick.bind(Object(u.a)(a)),a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"handleClick",value:function(){this.props.disabled||this.props.onClick()}},{key:"render",value:function(){var e=ye()("button","button--style-".concat(this.props.buttonStyle),"button--size-".concat(this.props.size));return this.props.to?r.a.createElement(f.b,{className:e,title:this.props.title,onClick:this.handleClick,to:this.props.to,disabled:this.props.disabled},this.props.children):r.a.createElement("button",{className:e,name:this.props.name,title:this.props.title,type:this.props.type,form:this.props.form,onClick:this.handleClick,disabled:this.props.disabled,tabIndex:this.props.tabIndex},this.props.children)}}]),t}(n.Component);je.defaultProps={type:"button",size:"base",form:null,buttonStyle:"primary",onClick:function(){return{}},disabled:!1};var Ue=je,Fe=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).onChange=a.onChange.bind(Object(u.a)(a)),a.handleChange=a.handleChange.bind(Object(u.a)(a)),a.onTogglePasswordShow=a.onTogglePasswordShow.bind(Object(u.a)(a)),a.id=Object(be.uniqueId)("".concat(a.props.name,"_input_")),a.state={showPassword:!1},a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.autoSelect&&setTimeout(function(){return e.input.select()},0)}},{key:"onChange",value:function(e){var t=e.value;this.props.onChange({name:this.props.name,value:t})}},{key:"onTogglePasswordShow",value:function(){this.setState({showPassword:!this.state.showPassword})}},{key:"handleChange",value:function(e){var t=e.target.value;this.onChange({value:t})}},{key:"select",value:function(){this.input.select()}},{key:"render",value:function(){var e=this,t=ye()("input","input--type-".concat(this.props.type),"input--size-".concat(this.props.size),{"input--error":this.props.error}),a=this.props,n=a.type,s=a.title,i=a.autoComplete,o=a.autoFocus,c=a.disabled,l=a.error,u=a.label,d=a.placeholder,h=a.readOnly,p=a.actions,m=a.inputProps;return r.a.createElement("div",{className:t},u&&r.a.createElement("label",{htmlFor:this.id},u,p.size>0&&r.a.createElement("span",{className:"input-label-actions"},p)),r.a.createElement("div",{className:"input--wrapper"},r.a.createElement("input",Object.assign({id:this.id,ref:function(t){e.input=t},name:this.id,title:s,type:"password"===n&&this.state.showPassword?"text":n,value:this.props.value,onChange:this.handleChange,placeholder:d,autoComplete:i?null:"new-password",autoFocus:o,disabled:c,readOnly:h},m)),"password"===n&&r.a.createElement("div",{className:"input--password-show"},r.a.createElement(Ue,{title:"Show",buttonStyle:"icon",onClick:this.onTogglePasswordShow,tabIndex:"-1"},r.a.createElement(Oe,{id:this.state.showPassword?"show":"hide",size:"small"})))),l&&r.a.createElement("span",{className:"input-error"},l))}}]),t}(n.Component);Fe.defaultProps={type:"text",value:"",autoFocus:!1,autoSelect:!1,autoComplete:!1,disabled:!1,readOnly:!1,actions:new m.a.List,size:"base",debounce:0};var Te=Fe,Ne=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).onSubmit=a.onSubmit.bind(Object(u.a)(a)),a.toggleSignup=a.toggleSignup.bind(Object(u.a)(a)),a.handleChange=a.handleChange.bind(Object(u.a)(a)),a.state={signup:!1,username:"",password:"",confirmPassword:"",showShortpass:j.canITryShortLogin()},a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"onSubmit",value:function(e){e&&e.preventDefault(),this.state.signup?x.createUser({username:this.state.username,password:this.state.password,confirmPassword:this.state.confirmPassword}):x.loginUser({username:this.state.username,password:this.state.password,token:this.state.token})}},{key:"toggleSignup",value:function(e){this.setState({signup:e})}},{key:"handleChange",value:function(e){var t=e.name,a=e.value;this.setState(Object(ve.a)({},t,a))}},{key:"render",value:function(){var e=this,t=this.state.signup?"Sign up":"Sign in";return r.a.createElement(we,{className:"user-connect-form",disabled:this.props.loading,onSubmit:this.onSubmit},r.a.createElement("h2",{className:"user-connect-title",title:q.isOnline()&&j.api.db},"Secret-in.me",r.a.createElement("small",null,t)),r.a.createElement(Te,{name:"username",label:"Username",type:"text",value:this.state.username,onChange:this.handleChange,disabled:this.props.loading,error:this.props.errors.get("username"),autoFocus:!0,autoComplete:!0}),r.a.createElement(Te,{name:"password",label:"Password",type:"password",value:this.state.password,onChange:this.handleChange,disabled:this.props.loading,error:this.props.errors.get("password"),autoComplete:!0}),this.props.errors.get("totp")&&r.a.createElement(Te,{name:"token",label:"Token",type:"text",value:this.state.token,onChange:this.handleChange,disabled:this.props.loading,error:this.props.errors.get("token"),autoFocus:!0}),this.state.signup&&r.a.createElement(Te,{name:"confirmPassword",label:"Confirm password",type:"password",value:this.state.confirmPassword,onChange:this.handleChange,disabled:this.props.loading,error:this.props.errors.get("confirmPassword")}),r.a.createElement(Ue,{type:"submit",disabled:this.props.loading||Object(be.isEmpty)(this.state.username)||Object(be.isEmpty)(this.state.password)},t),r.a.createElement("div",{className:"user-connect-create"},r.a.createElement("span",null,this.state.signup?r.a.createElement("span",null,"I already have an account,\xa0",r.a.createElement("a",{onClick:function(){e.toggleSignup(!e.state.signup)},tabIndex:"-1"},"sign in")):r.a.createElement("span",null,"I don't have an account,\xa0",r.a.createElement("a",{onClick:function(){e.toggleSignup(!e.state.signup)},tabIndex:"-1"},"create one")))))}}]),t}(n.Component),Pe=a(194),Re=a.n(Pe);function Ie(e){var t=ye()("modal",e.className,{"modal--centered":e.centered});return r.a.createElement(Re.a,{className:t,backdropClassName:"modal-backdrop",show:e.show,onHide:e.onClose,onBackdropClick:e.onClose},r.a.createElement("div",{className:"modal-dialog"},e.onClose&&r.a.createElement("button",{className:"modal-dialog-close",onClick:e.onClose},r.a.createElement(Oe,{id:"close",size:"small"})),e.children))}Ie.defaultProps={centered:!1},Ie.Body=function(e){return r.a.createElement("div",{className:"modal-body"},e.children)},Ie.Header=function(e){return r.a.createElement("div",{className:"modal-header"},r.a.createElement("h2",{className:"modal-header-title"},e.title||e.children))},Ie.Footer=function(e){return r.a.createElement("div",{className:"modal-footer"},e.children)};var Ae=Ie,Le=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).handleAccept=a.handleAccept.bind(Object(u.a)(a)),a.handleCancel=a.handleCancel.bind(Object(u.a)(a)),a.promise=new Promise(function(e,t){a.accept=e,a.cancel=t}),a.state={used:!1},a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"handleAccept",value:function(){this.setState({used:!0}),this.accept()}},{key:"handleCancel",value:function(){this.setState({used:!0}),this.cancel()}},{key:"render",value:function(){return r.a.createElement(Ae,{show:!0,centered:!0,onClose:this.promise.reject},this.props.title&&r.a.createElement(Ae.Header,null,this.props.title),r.a.createElement(Ae.Body,null,this.props.text),r.a.createElement(Ae.Footer,null,r.a.createElement(Ue,{type:"reset",buttonStyle:"default",onClick:this.handleCancel,disabled:this.state.used},this.props.cancelLabel),r.a.createElement(Ue,{buttonStyle:"primary",onClick:this.handleAccept,disabled:this.state.used},this.props.acceptLabel)))}}]),t}(n.Component);function Me(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=document.body.appendChild(document.createElement("div"));return i.a.render(r.a.createElement(Le,e),t).promise.then(e.onAccept).catch(e.onCancel).then(function(){i.a.unmountComponentAtNode(t),setTimeout(function(){return t.remove()})})}var De=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).handleChange=a.handleChange.bind(Object(u.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(u.a)(a)),a.handleDisable=a.handleDisable.bind(Object(u.a)(a)),a.state={shortpass:""},a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"handleChange",value:function(e){this.setState({shortpass:e.value})}},{key:"handleSubmit",value:function(){x.shortLogin({shortpass:this.state.shortpass})}},{key:"handleDisable",value:function(){var e=this;Me({title:"Are you sure?",text:r.a.createElement("span",null,"This will disable your short pass login access."),acceptLabel:"Disable short pass",cancelLabel:"Cancel",onAccept:function(){return x.disableShortLogin(),e.props.onCancel()},onCancel:function(){return{}}})}},{key:"render",value:function(){return r.a.createElement(we,{className:"user-connect-form",disabled:this.props.loading,onSubmit:this.handleSubmit},r.a.createElement("h2",{className:"user-connect-title"},"Hello again ",this.props.savedUsername,"!"),r.a.createElement(Te,{label:"Shortpass",name:"shortpass",value:this.state.shortpass,type:"password",onChange:this.handleChange,error:this.props.error,autoFocus:!0}),r.a.createElement(Ue,{type:"button",buttonStyle:"primary",disabled:this.props.loading||Object(be.isEmpty)(this.state.shortpass),onClick:this.handleSubmit},"Connect"),r.a.createElement("a",{className:"user-connect-more",tabIndex:-1,onClick:this.handleDisable},"Use another account"))}}]),t}(n.Component),_e=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).onSubmit=a.onSubmit.bind(Object(u.a)(a)),a.toggleSignup=a.toggleSignup.bind(Object(u.a)(a)),a.handleChange=a.handleChange.bind(Object(u.a)(a)),a.hideShortpass=a.hideShortpass.bind(Object(u.a)(a)),a.state={signup:!1,username:"",password:"",showShortpass:j.canITryShortLogin()},a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"onSubmit",value:function(e){e&&e.preventDefault(),this.state.signup?x.createUser({username:this.state.username,password:this.state.password}):x.loginUser({username:this.state.username,password:this.state.password,token:this.state.token})}},{key:"toggleSignup",value:function(e){var t=e.checked;this.setState({signup:t})}},{key:"handleChange",value:function(e){var t=e.name,a=e.value;this.setState(Object(ve.a)({},t,a))}},{key:"hideShortpass",value:function(){this.setState({showShortpass:!1})}},{key:"render",value:function(){var e=this.props,t=e.savedUsername,a=e.loading,n=e.errors;return r.a.createElement("div",{className:"user-connect"},this.state.showShortpass?r.a.createElement(De,{savedUsername:t,loading:a,error:n.get("shortlogin"),onCancel:this.hideShortpass}):r.a.createElement(Ne,{loading:a,errors:n}))}}]),t}(n.Component),ze=a(40),xe=a(202);function Be(e){var t=e.children,a=Object(xe.a)(e,["children"]);return r.a.createElement("li",{className:"sidebar-menu-item"},r.a.createElement(f.c,Object.assign({className:"sidebar-menu-link",activeClassName:"sidebar-menu-link--active"},a),t))}function He(){j.exportDb().then(function(e){!function(e,t){var a=document.createElement("a");a.setAttribute("href","data:application/json;charset=utf-8,".concat(encodeURIComponent(t))),a.setAttribute("download",e),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}("Secret-in_".concat(j.currentUser.username,"_").concat(ae()().format(),".json"),e)})}var Ge=function(){var e=q.getCurrentUser();return r.a.createElement("div",{className:"sidebar"},r.a.createElement("div",{className:"sidebar-header"},r.a.createElement(f.b,{to:"/",title:q.isOnline()&&j.api.db},q.isOnline()?"Secret-In.me":"Offline")),r.a.createElement("div",{className:"sidebar-content"},r.a.createElement("ul",{className:"sidebar-menu"},r.a.createElement(Be,{to:"/secrets/",exact:!0},r.a.createElement(Oe,{id:"home",size:"base"}),e.username),r.a.createElement("div",{className:"sidebar-separator"}),r.a.createElement(Be,{to:"/secrets/all/"},r.a.createElement(Oe,{id:"apps",size:"base"}),"All"),r.a.createElement(Be,{to:"/secrets/mine",exact:!0},r.a.createElement(Oe,{id:"user",size:"base"}),"My secrets"),r.a.createElement(Be,{to:"/secrets/shared",exact:!0},r.a.createElement(Oe,{id:"people",size:"base"}),"Shared secrets"),r.a.createElement("div",{className:"sidebar-separator"}),r.a.createElement(Be,{to:"/settings/"},r.a.createElement(Oe,{id:"gear",size:"base"}),"Settings"),r.a.createElement("div",{className:"sidebar-separator"}),r.a.createElement("li",{className:"sidebar-menu-item"},r.a.createElement("a",{className:"sidebar-menu-link",onClick:He},r.a.createElement(Oe,{id:"export",size:"base"}),"Export secrets")),r.a.createElement(Be,{to:"/import/"},r.a.createElement(Oe,{id:"import",size:"base"}),"Import secrets"))))},Qe=function(){function e(){Object(o.a)(this,e),this.generateActions("showModal","showSecretSuccess","hideModal","changeTab")}return Object(d.a)(e,[{key:"showSecret",value:function(e){var t=this,a=e.secret,n=e.tab;return this.showModal({secret:a,tab:n}),function(e){e(),"folder"===a.type?t.showSecretSuccess({secret:a}):j.getSecret(a.id).then(function(e){var n=e.fields?e:{fields:e};t.showSecretSuccess({secret:a.set("data",ue.createFromRaw(n))})})}}}]),e}(),Ke=N.createActions(Qe),Je=new p.Record({secret:null,errors:new m.a.Map,tab:"details",isUpdating:!1}),qe=Q.UPDATE_SECRET,Ye=Q.UPDATE_SECRET_SUCCESS,We=Q.UPDATE_SECRET_FAILURE,Ve=Q.RENAME_SECRET,$e=Q.RENAME_SECRET_SUCCESS,Xe=Q.RENAME_SECRET_FAILURE,Ze=Q.CREATE_SECRET_USER_RIGHTS,et=Q.UPDATE_SECRET_USER_RIGHTS,tt=Q.DELETE_SECRET_USER_RIGHTS,at=Q.CREATE_SECRET_USER_RIGHTS_SUCCESS,nt=Q.UPDATE_SECRET_USER_RIGHTS_SUCCESS,rt=Q.DELETE_SECRET_USER_RIGHTS_SUCCESS,st=Q.CREATE_SECRET_USER_RIGHTS_FAILURE,it=Q.UPDATE_SECRET_USER_RIGHTS_FAILURE,ot=Q.DELETE_SECRET_USER_RIGHTS_FAILURE,ct=function(){function e(){Object(o.a)(this,e),this.bindActions(Ke),this.bindAction(qe,this.onUpdateSecret),this.bindAction(Ve,this.onUpdateSecret),this.bindAction(Ze,this.onUpdateSecret),this.bindAction(Ze,this.onUpdateSecret),this.bindAction(et,this.onUpdateSecret),this.bindAction(tt,this.onUpdateSecret),this.bindAction(Ye,this.onUpdateSecretSuccess),this.bindAction(We,this.onUpdateSecretFailure),this.bindAction($e,this.onUpdateSecretSuccess),this.bindAction(Xe,this.onUpdateSecretFailure),this.bindAction(at,this.onUpdateSecretSuccess),this.bindAction(nt,this.onUpdateSecretSuccess),this.bindAction(rt,this.onUpdateSecretSuccess),this.bindAction(st,this.onUpdateSecretFailure),this.bindAction(it,this.onUpdateSecretFailure),this.bindAction(ot,this.onUpdateSecretFailure),this.state=new Je}return Object(d.a)(e,[{key:"onShowModal",value:function(e){var t=e.secret,a=e.tab;this.setState(this.state.merge({secret:t,tab:a||"details",errors:new m.a.Map}))}},{key:"onShowSecretSuccess",value:function(e){var t=e.secret;this.setState(this.state.set("secret",t).set("errors",new m.a.Map))}},{key:"onHideModal",value:function(){this.setState(this.state.set("secret",null).set("errors",new m.a.Map))}},{key:"onChangeTab",value:function(e){var t=e.tab;this.setState(this.state.set("tab",t))}},{key:"onUpdateSecret",value:function(){this.setState(this.state.set("errors",new m.a.Map).set("isUpdating",!0))}},{key:"onUpdateSecretSuccess",value:function(){var e=this;this.waitFor(ge),this.setState(this.state.update("secret",function(t){return t?t.merge(ge.getById(e.state.secret.id).toMap().remove("data")):null}).set("isUpdating",!1).set("errors",new m.a.Map))}},{key:"onUpdateSecretFailure",value:function(e){var t=e.error;this.setState(this.state.set("errors",new m.a.Map(t)).set("isUpdating",!1))}}]),e}(),lt=N.createStore(B(ct),"ShowSecretUIStore"),ut=N.createActions(function e(){Object(o.a)(this,e),this.generateActions("changeField")}),dt=new p.Record({isEditing:!1,data:null}),ht=function(){function e(){Object(o.a)(this,e),this.bindActions(ut),this.bindAction(Ke.SHOW_SECRET_SUCCESS,this.onUpdateSecret),this.bindAction(Ke.HIDE_MODAL,this.onHideModal),this.bindAction(Q.UPDATE_SECRET_SUCCESS,this.onUpdateData),this.state=new dt}return Object(d.a)(e,[{key:"onUpdateSecret",value:function(e){var t=e.secret;this.setState(this.state.merge({isEditing:!1,data:t.data}))}},{key:"onUpdateData",value:function(e){var t=e.data;this.setState(this.state.merge({isEditing:!1,data:t}))}},{key:"onHideModal",value:function(){this.setState(this.state.merge({isEditing:!1,data:null}))}},{key:"onChangeField",value:function(e){var t=e.field,a=e.value;this.setState(this.state.updateIn(["data","fields"],function(e){return e.update(e.findIndex(function(e){return e.id===t.id}),function(e){return e.set("content",a)})}).set("isEditing",!0))}}]),e}(),pt=N.createStore(B(ht),"EditSecretUIStore"),mt=a(88),ft=a.n(mt),gt=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).onCopy=a.onCopy.bind(Object(u.a)(a)),a.onGenerate=a.onGenerate.bind(Object(u.a)(a)),a.handleChange=a.handleChange.bind(Object(u.a)(a)),a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"onCopy",value:function(){ft()(this.props.field.content,{debug:!0})}},{key:"onGenerate",value:function(){var e=this;this.handleChange({value:""}),setTimeout(function(){e.handleChange({value:S.Utils.PasswordGenerator.generatePassword()})},100)}},{key:"handleChange",value:function(e){var t=e.value,a={field:this.props.field,value:t};this.props.onChange(a)}},{key:"render",value:function(){var e=this,t=[];return this.props.isNew||"url"===this.props.field.type&&t.push(r.a.createElement("a",{key:"open",href:this.props.field.content,target:"_blank",rel:"noopener noreferrer",tabIndex:"-1"},"Open")),t.push(r.a.createElement("a",{key:"copy",onClick:this.onCopy,tabIndex:"-1"},"Copy")),r.a.createElement("div",{className:"secret-field"},r.a.createElement(Te,{ref:function(t){e.input=t},label:this.props.field.label,name:this.props.field.label,value:this.props.field.content,onChange:this.handleChange,type:this.props.field.type,readOnly:!this.props.canUpdate,actions:new m.a.List(t)}),r.a.createElement("div",{className:"secret-field-action"},"password"===this.props.field.type&&this.props.canUpdate&&r.a.createElement(Ue,{title:"Generate password",buttonStyle:"icon",onClick:this.onGenerate,tabIndex:"-1"},r.a.createElement(Oe,{id:"generate",size:"small"}))))}}]),t}(n.Component),vt=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this;return!!this.props.fields&&r.a.createElement("div",{className:"secret-fields"},this.props.fields.map(function(t){return r.a.createElement(gt,{key:t.id,field:t,onChange:e.props.onChange,isNew:e.props.isNew,canUpdate:e.props.canUpdate})}))}}]),t}(n.Component),bt=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return this.props.data?r.a.createElement("div",{className:"secret-edit"},r.a.createElement(vt,{fields:this.props.data.get("fields"),onChange:this.props.canUpdate?ut.changeField:function(){},canUpdate:this.props.canUpdate})):r.a.createElement("pre",null,"Loading...")}}],[{key:"getStores",value:function(){return[pt]}},{key:"getPropsFromStores",value:function(){return{data:pt.getState().get("data")}}}]),t}(n.Component),St=v()(bt),yt=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).onChange=function(e){var t=e.target;a.props.onChange({name:a.props.name,value:t.value})},a.getValue=function(){return a.select.value},a.id=Object(be.uniqueId)("input_"),a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this,t=ye()("input","input--type-select","input--size-".concat(this.props.size));return r.a.createElement("div",{className:t},this.props.label&&r.a.createElement("label",{htmlFor:this.id},this.props.label,this.props.actions.size>0&&r.a.createElement("span",{className:"input-label-actions"},this.props.actions)),r.a.createElement("div",{className:"input--type-select--input"},r.a.createElement("select",{ref:function(t){e.select=t},value:this.props.value,disabled:this.props.disabled,title:this.props.title,onChange:this.onChange},this.props.options.map(function(e){return r.a.createElement("option",{key:e[0],value:e[0]},e[1])})),r.a.createElement(Oe,{id:"arrow-down"})))}}]),t}(n.Component);yt.defaultProps={disabled:!1,size:"base",onChange:be.noop,actions:new m.a.List};var Et=yt,wt=function(e){function t(){var e,a;Object(o.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(c.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).handleClick=function(){ft()(a.select.getValue(),{debug:!0})},a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this;if(!this.props.data)return r.a.createElement("pre",null,"Loading...");var t=this.props.data.fields.sortBy(function(e){return e.date}).reverse().map(function(e){return[e.content,ae()(e.date).format("dddd DD MMMM YYYY")]}).toList();return r.a.createElement("div",{className:"secret-edit"},r.a.createElement("div",{className:"secret-field"},r.a.createElement(Et,{label:"Passwords",ref:function(t){e.select=t},options:t}),r.a.createElement(Ue,{onClick:this.handleClick},"Copy")))}}],[{key:"getStores",value:function(){return[pt]}},{key:"getPropsFromStores",value:function(){return{data:pt.getState().get("data")}}}]),t}(n.Component),Ct=v()(wt),kt=["green-sea","nephritis","belize-hole","wisteria","midnight-blue","orange","pumpkin","pomegranate","silver","asbestos"];function Ot(e){var t=e.user,a=e.size,n=function(e){var t=e.split("").reduce(function(e,t){return e+t.charCodeAt()},0);return kt[t%kt.length]}(t.username),s=ye()("user-avatar","user-avatar--color-".concat(n),"user-avatar--size-".concat(a));return r.a.createElement("div",{className:s,title:t.username},function(e){var t=e.split(" ");return t.length>1?"".concat(t[0][0]).concat(t[1][0]).toUpperCase():e.substring(0,2).toUpperCase()}(t.username))}Ot.defaultProps={size:"base"};var jt=Ot;var Ut=function(e){var t=e.user,a=e.disabled,n=e.disabledReason,s=e.onChangeUserRights,i=e.onRemoveUserRights;return r.a.createElement("div",{className:"secret-users-list-item"},r.a.createElement("div",{className:"secret-users-list-item-infos"},r.a.createElement(jt,{user:t,size:"large"}),t.username),r.a.createElement("div",{className:"secret-users-list-item-actions"},r.a.createElement(Et,{value:t.rights,options:re.map(function(e){return[e,se(e)]}),size:"small",disabled:a,title:n,onChange:function(e){var a=e.value;return s(t,a)}}),r.a.createElement(Ue,{buttonStyle:"icon",onClick:function(){return i(t)},disabled:a,title:n,size:"small",iconOnly:!0},r.a.createElement(Oe,{id:"close"}))))},Ft=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).handleChange=a.handleChange.bind(Object(u.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(u.a)(a)),a.state={user:ie.createFromRaw({username:"",rights:0})},a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"handleChange",value:function(e){var t=e.name,a=e.value;this.setState({user:this.state.user.set(t,a)})}},{key:"handleSubmit",value:function(){var e=this,t=this.props.secret,a=this.state.user,n=["read access","read and write access","read, write and share access"][a.rights],s=a.username,i=t.title;Me({title:"Are you sure?",text:r.a.createElement("span",null,"You are about to give ",r.a.createElement("b",null,n)," to ",r.a.createElement("b",null,s)," on ",r.a.createElement("b",null,i),"."),acceptLabel:"Share the secret",cancelLabel:"Cancel",onAccept:function(){Q.createSecretUserRights({secret:e.props.secret,user:e.state.user,rights:e.state.user.rights}),e.setState({user:ie.createFromRaw({username:"",rights:0})})},onCancel:function(){return{}}})}},{key:"render",value:function(){return r.a.createElement("div",{className:"secret-users-list-new"},r.a.createElement(Te,{name:"username",placeholder:"User name...",value:this.state.user.username,size:"small",onChange:this.handleChange,error:this.props.errors.get("username")}),r.a.createElement(Et,{name:"rights",value:this.state.user.rights,size:"small",onChange:this.handleChange,options:re.map(function(e){return[e,se(e)]})}),r.a.createElement(Ue,{buttonStyle:"icon",onClick:this.handleSubmit,disabled:!this.state.user.isValid(),size:"small",iconOnly:!0},r.a.createElement(Oe,{id:"add"})))}}]),t}(n.Component);var Tt=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).onChangeUserRights=a.onChangeUserRights.bind(Object(u.a)(a)),a.onRemoveUserRights=a.onRemoveUserRights.bind(Object(u.a)(a)),a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"onChangeUserRights",value:function(e,t){Q.updateSecretUserRights({secret:this.props.secret,user:e,rights:t})}},{key:"onRemoveUserRights",value:function(e){Q.deleteSecretUserRights({secret:this.props.secret,user:e})}},{key:"render",value:function(){var e=this,t=q.getCurrentUser(),a=this.props.secret.canBeSharedBy(t)&&q.isOnline();return r.a.createElement("div",{className:"secret-users"},r.a.createElement("div",{className:"secret-users-list"},this.props.secret.users.map(function(n){return r.a.createElement(Ut,{key:n.id,user:n,disabled:!a||t.username===n.id||e.props.isUpdating,disabledReason:(s=!a,i=t.username===n.id,s?"You dn't have the permission to share this secret":i?"You can't modify or remove yourself":null),onChangeUserRights:e.onChangeUserRights,onRemoveUserRights:e.onRemoveUserRights});var s,i}).toArray()),a&&r.a.createElement(Ft,{secret:this.props.secret,errors:this.props.errors}))}}]),t}(n.Component),Nt=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).handleSubmit=function(){return a.props.onSubmit(a.state.title)},a.handleKeyDown=function(e){var t=e.key,a=e.target;"Enter"===t&&a.blur()},a.handleChange=function(e){var t=e.target;a.setState({title:t.value})},a.state={title:e.title},a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props,t=e.canUpdate,a=e.isUpdating,n=this.state.title;return r.a.createElement("input",{className:"secret-editable-title",type:"text",value:n,onBlur:this.handleSubmit,onKeyDown:this.handleKeyDown,onChange:this.handleChange,readOnly:!t||a,size:n.length+1})}}]),t}(n.Component);function Pt(e){var t=e.type,a=e.children,n=ye()("flash","flash--type-".concat(t));return r.a.createElement("div",{className:n},r.a.createElement("div",{className:"flash-icon"},r.a.createElement(Oe,{id:t,size:"small"})),r.a.createElement("div",{className:"flash-content"},a))}Pt.defaultProps={type:"info"};var Rt=Pt,It=a(195),At=a.n(It),Lt=a(196),Mt=function(e){return r.a.createElement(At.a,Object.assign({className:"tabs",animation:!1},e),e.children)},Dt=a.n(Lt).a,_t=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).handleChangeTab=a.handleChangeTab.bind(Object(u.a)(a)),a.handleClick=a.handleClick.bind(Object(u.a)(a)),a}return Object(h.a)(t,e),Object(d.a)(t,null,[{key:"getStores",value:function(){return[lt,pt]}},{key:"getPropsFromStores",value:function(){var e=lt.getState();return{secret:e.secret,errors:e.errors,shown:!!e.secret,tab:e.tab,isUpdating:e.isUpdating,isEditing:pt.getState().get("isEditing")}}}]),Object(d.a)(t,[{key:"handleChangeTab",value:function(e){Ke.changeTab({tab:e})}},{key:"handleClick",value:function(){Q.updateSecret({secret:this.props.secret,data:pt.getState().get("data")})}},{key:"render",value:function(){var e=this;if(!this.props.secret)return!1;var t=q.getCurrentUser().username,a=this.props.secret.users.toList().filterNot(function(e){return e.id===t}),n=this.props.secret.canBeUpdatedBy(q.getCurrentUser())&&(q.isOnline()||0===a.size);return r.a.createElement(Ae,{show:this.props.shown,onClose:Ke.hideModal},r.a.createElement(Ae.Header,null,r.a.createElement(Oe,{id:this.props.secret.getIcon(),size:"small"}),r.a.createElement(Nt,{title:this.props.secret.title,canUpdate:n,isUpdating:this.props.isUpdating,onSubmit:function(t){t!==e.props.secret.title&&setTimeout(function(){Q.renameSecret({secret:e.props.secret,newTitle:t})})}})),r.a.createElement(Ae.Body,null,"windows"===this.props.secret.type&&r.a.createElement(Rt,{type:"info"},"This secret is used for your Windows domain authentication. It cannot be deleted."),r.a.createElement(Mt,{id:"secret-tabs",activeKey:this.props.tab,onSelect:this.handleChangeTab},"folder"!==this.props.secret.type&&r.a.createElement(Dt,{eventKey:"details",title:"Details"},"windows"===this.props.secret.type?r.a.createElement(Ct,{isUpdating:this.props.isUpdating}):r.a.createElement(St,{isUpdating:this.props.isUpdating,canUpdate:n})),"windows"!==this.props.secret.type&&r.a.createElement(Dt,{eventKey:"access",title:"Who has access"},r.a.createElement(Tt,{isUpdating:this.props.isUpdating,errors:this.props.errors,secret:this.props.secret})))),r.a.createElement(Ae.Footer,null,r.a.createElement(Ue,{type:"reset",buttonStyle:"default",onClick:Ke.hideModal,disabled:this.props.isUpdating},"Close"),this.props.isEditing&&r.a.createElement(Ue,{type:"submit",buttonStyle:"primary",onClick:this.handleClick,disabled:this.props.isUpdating},"Save")))}}]),t}(n.Component),zt=v()(_t),xt=a(67),Bt=a.n(xt),Ht=a(28),Gt=a(198),Qt=a.n(Gt);function Kt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new m.a.List,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/secrets";return Qt()(t,e.toArray().join("/"),"/")}function Jt(e){var t=e.users,a=e.size,n=ye()("user-avatars","user-avatars--size-".concat(a));return r.a.createElement("div",{className:n},t.map(function(e){return r.a.createElement(jt,{key:e.id,user:e,size:a})}).toArray())}Jt.defaultProps={size:"base"};var qt=Jt,Yt=a(132),Wt=a.n(Yt),Vt=a(199),$t=a.n(Vt);Wt.a.MenuItem=function(e){return r.a.createElement($t.a,Object.assign({className:"dropdown-menu-item"},e))};var Xt=Wt.a,Zt=function(e){function t(){var e,a;Object(o.a)(this,t);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(s)))).handleShow=function(){var e=a.props.secret;Ke.showSecret({secret:e,tab:"folder"===e.type?"access":"details"})},a.handleShare=function(){var e=a.props.secret;Ke.showSecret({secret:e,tab:"access"})},a.handleMoveToParent=function(){var e=a.props,t=e.parentFolderId,n=e.secret;Q.removeSecretFromCurrentFolder({secret:n,currentFolderId:t})},a.handleDelete=function(){var e=a.props.secret;return Me({title:r.a.createElement("span",null,"Delete ",r.a.createElement("b",null,e.title),"?"),text:r.a.createElement("span",null,"You are about to ",r.a.createElement("b",null,"delete")," the secret ",r.a.createElement("b",null,e.title),". This action is definitive and can't be recovered."),acceptLabel:"Delete the secret",cancelLabel:"Cancel",onAccept:function(){return Q.deleteSecret({secret:e})},onCancel:function(){return{}}}),!0},a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this.props,t=e.parentFolderId,a=e.secret,n=q.getCurrentUser(),s=ge.getById(t),i=a.canBeSharedBy(n);return i||"folder"!==a.type?r.a.createElement(Xt,{id:"secret-action",pullRight:!0},r.a.createElement(Xt.Toggle,null,r.a.createElement(Oe,{id:"more-vert",size:"small"})),r.a.createElement(Xt.Menu,null,"folder"!==a.type&&r.a.createElement(Xt.MenuItem,{onSelect:this.handleShow},"Show"),i&&r.a.createElement(Xt.MenuItem,{onSelect:this.handleShare,disabled:!q.isOnline()},"Share"),(t||a.canBeDeleted())&&r.a.createElement("div",null,r.a.createElement(Xt.MenuItem,{divider:!0}),t&&r.a.createElement(Xt.MenuItem,{onSelect:this.handleMoveToParent},"Remove from\xa0",r.a.createElement("b",null,s.title)),a.canBeDeleted()&&r.a.createElement(Xt.MenuItem,{onSelect:this.handleDelete,disabled:!q.isOnline()},"Delete")))):null}}]),t}(n.Component);var ea={drop:function(e,t){var a=e.secret,n=t.getItem().secret;Q.addSecretToFolder({secret:n,folder:a})},canDrop:function(e,t){var a=e.secret,n=q.getCurrentUser().username,r=t.getItem().secret;return 0!==r.getIn(["users",n,"rights"])&&"folder"===a.type&&a.id!==r.id&&0!==a.getIn(["users",n,"rights"])}};var ta=new Ht.DragSource("SecretListItem",{beginDrag:function(e){return{secret:e.secret}}},function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}})(function(e){var t=e.secret,a=e.folders,n=e.isDragging,s=e.canDrop,i=e.isOver,o=e.connectDragSource,c=e.connectDropTarget,l=q.getCurrentUser(),u=t.getIn(["users",l.username,"rights"]),d=t.users.toList().filterNot(function(e){return e.id===l.username}),h=ye()("secret-list-item",{"secret-list-item--is-dragging":n,"secret-list-item--is-over":i,"secret-list-item--can-drop":s,"secret-list-item--cant-drop":!s}),p=r.a.createElement("div",null,r.a.createElement(f.b,{to:Kt(a.push(t.id))},r.a.createElement(Oe,{id:t.getIcon(),size:"base"}),r.a.createElement("span",{className:"text",title:t.title},t.title)));return c(r.a.createElement("tr",{className:h},r.a.createElement("td",{className:"secret-list-item-column secret-list-item-column--title"},u>0&&(q.isOnline()||0===d.size)?o(p):p),r.a.createElement("td",{className:"secret-list-item-column secret-list-item-column--last-modified"},t.lastModifiedAt.fromNow()," - ",r.a.createElement("span",{className:"muted"},t.lastModifiedBy)),r.a.createElement("td",{className:"secret-list-item-column secret-list-item-column--shared-with"},d.size>0?r.a.createElement(qt,{users:d}):"\u2013\u2013"),r.a.createElement("td",{className:"secret-list-item-column secret-list-item-column--actions"},r.a.createElement(Zt,{parentFolderId:a.last(),secret:t}))))}),aa=new Ht.DropTarget("SecretListItem",ea,function(e,t){return{connectDropTarget:e.dropTarget(),canDrop:t.canDrop(),isOver:t.isOver()}})(ta);var na=new Ht.DragSource("SecretListItem",{beginDrag:function(e){return{secret:e.secret}}},function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging()}})(function(e){var t=e.secret,a=e.parentFolderId,n=e.isDragging,s=e.connectDragSource,i=q.getCurrentUser(),o=t.users.toList().filterNot(function(e){return e.id===i.username}),c=t.getIn(["users",i.username,"rights"]),l=ye()("secret-list-item",{"secret-list-item--is-dragging":n}),u=r.a.createElement("div",null,r.a.createElement("a",{onClick:function(){return Ke.showSecret({secret:t})},tabIndex:"-1"},r.a.createElement(Oe,{id:t.getIcon(),size:"base"}),r.a.createElement("span",{className:"text",title:t.title},t.title)));return r.a.createElement("tr",{className:l},r.a.createElement("td",{className:"secret-list-item-column secret-list-item-column--title"},c>0&&(q.isOnline()||0===o.size)?s(u):u),r.a.createElement("td",{className:"secret-list-item-column secret-list-item-column--last-modified"},t.lastModifiedAt.fromNow()," - ",r.a.createElement("span",{className:"muted"},t.lastModifiedBy)),r.a.createElement("td",{className:"secret-list-item-column secret-list-item-column--shared-with"},o.size>0?r.a.createElement(qt,{users:o}):"\u2013\u2013"),r.a.createElement("td",{className:"secret-list-item-column secret-list-item-column--actions"},r.a.createElement(Zt,{parentFolderId:a,secret:t})))});var ra=function(e){var t=e.secret,a=e.folders;return"folder"===t.type?r.a.createElement(aa,{secret:t,folders:a}):r.a.createElement(na,{parentFolderId:a.last(),secret:t})};function sa(e){var t=e.icon,a=e.title,n=e.link;return r.a.createElement("div",{className:"breadcrumb-item"},r.a.createElement(f.c,{to:n,className:"breadcrumb-link",activeClassName:"breadcrumb-link--active",exact:!0},r.a.createElement(Oe,{id:t,size:"base"}),a))}sa.defaultProps={icon:"home",title:"Home",link:"/secrets/"};var ia=sa,oa={folders:new m.a.List,withTitle:!0};function ca(e){var t=e.folders,a=e.withTitle,n=t.reduce(function(e,t){return e.push({folderId:t,link:Kt(new m.a.List([t]),e.last()?e.last().link:void 0)})},new m.a.List).reduce(function(e,t,a){var n=t.folderId,s=t.link,i=ge.getById(n);return i?e.push(r.a.createElement("div",{key:a,className:"breadcrumb-item"},r.a.createElement(f.c,{to:s,className:"breadcrumb-link",activeClassName:"breadcrumb-link--active",exact:!0},i.title))).push(r.a.createElement(Oe,{key:"".concat(a,"-sep"),id:"chevron-right",className:"breadcrumb-item-separator"})):e},new m.a.List),s=q.getCurrentUser();return a&&(n=n.unshift(r.a.createElement(Oe,{key:"home-sep",id:"chevron-right",className:"breadcrumb-item-separator"})).unshift(r.a.createElement(ia,{key:"home",title:s.username,icon:"home",link:"/secrets/"}))),r.a.createElement("div",{className:"breadcrumb"},n)}ca.defaultProps=oa;var la=ca;var ua=function(e){var t=e.folder,a=t.get("secrets").sortBy(function(e){return e.get("title").toLowerCase()});return r.a.createElement("tbody",{className:"secret-list-content-table-body"},!t.has("root")&&r.a.createElement("tr",{className:"secret-list-folder"},r.a.createElement("td",{colSpan:"4",className:"secret-list-folder-info"},r.a.createElement(la,{folders:t.get("breadcrumb"),withTitle:!1}))),a.map(function(e){return r.a.createElement(na,{key:e.id,secret:e})}).toArray())},da=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(d.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return e.endDecrypt||e.searchQuery!==this.props.searchQuery||e.filtered!==this.props.filtered||e.folders.size!==this.props.folders.size}},{key:"render",value:function(){var e=this,t=ye()("secret-list-content-table",{"secret-list-content-table--is-dragging":this.props.isDragging}),a=new RegExp(this.props.searchQuery.split("").map(function(e){return Object(be.escapeRegExp)(e)}).join(".*"),"i"),n=this.props.secrets.filter(function(e){return a.test(e.title)}),s=new m.a.Map,i=q.getCurrentUser();if(this.props.filtered){var o=ge.getAllFolders();n.forEach(function(e){var t=e.getIn(["users",i.username,"folders"]).entrySeq().first();if("undefined"===typeof t&&(t=["ROOT"]),s=s.setIn([t[0],"secrets",e.id],e),"ROOT"===t[0])s=(s=s.setIn([t[0],"name"],"")).setIn([t[0],"root"],!0);else{for(var a=!1,n=m.a.List(),r=t;!a;)a=o.getIn([r[0],"users",i.username,"folders"]).has("ROOT"),n=n.unshift(r[0]),r=o.getIn([r[0],"users",i.username,"folders"]).entrySeq().first();s=(s=s.setIn([t[0],"name"],n.join("/"))).setIn([t[0],"breadcrumb"],n)}}),s=s.sortBy(function(e){return e.get("name").toLowerCase()}).sortBy(function(e){return!e.has("root")})}else n=n.sortBy(function(e){return e.get("title").toLowerCase()});return r.a.createElement("table",{className:t},r.a.createElement("thead",{className:"secret-list-content-table-header"},r.a.createElement("tr",null,r.a.createElement("th",{className:"secret-list-item-column--title"},"Title"),r.a.createElement("th",{className:"secret-list-item-column--last-modified"},"Last modified"),r.a.createElement("th",{className:"secret-list-item-column--shared-with"},"Shared with"),r.a.createElement("th",{className:"secret-list-item-column--actions"}))),this.props.filtered?s.map(function(e,t){return r.a.createElement(ua,{key:t,folder:e})}).toArray():r.a.createElement("tbody",{className:"secret-list-content-table-body"},n.map(function(t){return r.a.createElement(ra,{key:t.id,secret:t,folders:e.props.folders})}).toArray()))}}]),t}(n.Component);var ha=function(){return r.a.createElement("div",{className:"secret-list-refresh"},r.a.createElement(Ue,{title:"Refresh secret list",buttonStyle:"icon",onClick:Q.loadMetadata},r.a.createElement(Oe,{id:"refresh"})))},pa=N.createActions(function e(){Object(o.a)(this,e),this.generateActions("showModal","hideModal","changeTitle","changeField")}),ma=new p.Record({shown:!1,folder:null,isFolder:!1,title:"",data:ue.createWithDefaultFields(ue.DEFAULT_FIELDS)}),fa=function(){function e(){Object(o.a)(this,e),this.bindActions(pa),this.bindAction(Q.CREATE_SECRET_SUCCESS,this.onHideModal),this.state=new ma}return Object(d.a)(e,[{key:"onShowModal",value:function(e){var t=e.folder,a=e.isFolder;this.setState(this.state.merge({shown:!0,title:"Untilted ".concat(a?"folder":"secret"),folder:t,isFolder:a}))}},{key:"onHideModal",value:function(){this.setState(new ma)}},{key:"onChangeTitle",value:function(e){var t=e.value;this.setState(this.state.set("title",t))}},{key:"onChangeField",value:function(e){var t=e.field,a=e.value;this.setState(this.state.updateIn(["data","fields"],function(e){return e.update(e.findIndex(function(e){return e.id===t.id}),function(e){return e.set("content",a)})}))}}]),e}(),ga=N.createStore(B(fa),"NewSecretUIStore"),va=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).onSubmit=a.onSubmit.bind(Object(u.a)(a)),a}return Object(h.a)(t,e),Object(d.a)(t,null,[{key:"getStores",value:function(){return[ga]}},{key:"getPropsFromStores",value:function(){return ga.getState().toObject()}}]),Object(d.a)(t,[{key:"onSubmit",value:function(){var e=this.props,t=e.folder,a=e.isFolder,n=e.title,r=e.data;Q.createSecret({folder:t,isFolder:a,title:n,data:r})}},{key:"render",value:function(){var e=this.props.isFolder;return r.a.createElement(Ae,{show:this.props.shown,onClose:pa.hideModal},r.a.createElement(Ae.Header,{title:e?"Add new folder":"Add new secret"}),r.a.createElement(Ae.Body,null,r.a.createElement(we,{id:"new-secret",onSubmit:this.onSubmit,disabled:!1},r.a.createElement(Te,{label:e?"Folder title":"Secret title",name:"title",value:this.props.title,type:"text",onChange:pa.changeTitle,autoSelect:!0,required:!0}),!e&&r.a.createElement(vt,{fields:this.props.data.fields,onChange:pa.changeField,isNew:!0,canUpdate:!0}))),r.a.createElement(Ae.Footer,null,r.a.createElement(Ue,{type:"reset",buttonStyle:"default",onClick:pa.hideModal},"Cancel"),r.a.createElement(Ue,{type:"submit",onClick:this.onSubmit,disabled:q.isLoading()},e?"Add folder":"Add secret")))}}]),t}(n.Component),ba=v()(va);var Sa=function(e){var t=e.folder,a=null,n=!0;if(t){a=t.id;var s=q.getCurrentUser();n=t.canBeUpdatedBy(s)}return r.a.createElement("div",{className:"secret-list-new"},r.a.createElement(ba,null),r.a.createElement(Ue,{title:"Add secret",buttonStyle:"primary",size:"small",disabled:!n,onClick:function(){return pa.showModal({folder:a,isFolder:!1})}},r.a.createElement(Oe,{id:"add-secret",size:"small"}),"Add secret"),r.a.createElement(Ue,{title:"Add secret",buttonStyle:"primary",size:"small",disabled:!n,onClick:function(){return pa.showModal({folder:a,isFolder:!0})}},r.a.createElement(Oe,{id:"add-folder",size:"small"}),"Create folder"))},ya=a(133),Ea=a.n(ya),wa=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).onChange=a.onChange.bind(Object(u.a)(a)),a.focus=a.focus.bind(Object(u.a)(a)),a.blur=a.blur.bind(Object(u.a)(a)),a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){Ea.a.bind("mod+f",this.focus)}},{key:"componentWillUnmount",value:function(){Ea.a.unbind("mod+f",this.focus)}},{key:"onChange",value:function(e){this.props.onChange(e.target.value)}},{key:"focus",value:function(e){this.searchInput!==document.activeElement&&(this.searchInput.focus(),e.preventDefault())}},{key:"blur",value:function(e){"Escape"===e.key&&""===e.target.value&&this.searchInput.blur()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"input input--type-search input--size-small"},r.a.createElement("input",{ref:function(t){e.searchInput=t},type:"search",placeholder:"Search...",onChange:this.onChange,onKeyDown:this.blur}))}}]),t}(n.Component),Ca=k.DecryptMetadataStatus,ka=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).state={message:""},a}return Object(h.a)(t,e),Object(d.a)(t,null,[{key:"getDerivedStateFromProps",value:function(e){var t=e.status;return{message:t instanceof Ca?"Updating your secrets...":t.message}}}]),Object(d.a)(t,[{key:"render",value:function(){var e=this.props.status,t=e.state,a=e.total,n="".concat(Math.round(t/a*100),"%"),s={width:n};return r.a.createElement("div",{className:"user-connect-progress"},r.a.createElement("div",{className:"user-connect-progress-bar",style:s}),r.a.createElement("div",{className:"user-connect-progress-text"},this.state.message),r.a.createElement("div",{className:"user-connect-progress-title"},n))}}]),t}(n.Component),Oa=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).onSearch=a.onSearch.bind(Object(u.a)(a)),a.state={searchQuery:e.searchQuery},a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"onSearch",value:function(e){this.setState({searchQuery:e})}},{key:"render",value:function(){var e,t,a,n=!1;return this.props.showAll?(e="apps",t="All",a="/secrets/all/",n=!0):this.props.showMine?(e="user",t="My secrets",a="/secrets/mine/",n=!0):this.props.showShared&&(e="people",t="Shared secrets",a="/secrets/shared/",n=!0),r.a.createElement("div",{className:"page"},r.a.createElement("div",{className:"page-header"},n?r.a.createElement("div",{className:"breadcrumb"},r.a.createElement(ia,{icon:e,title:t,link:a})):r.a.createElement(la,{folders:this.props.folders}),r.a.createElement(ha,null),r.a.createElement(wa,{onChange:this.onSearch})),null!==q.getState().get("status")&&r.a.createElement(ka,{status:q.getState().get("status")}),r.a.createElement("div",{className:"page-content"},!this.props.showAll&&!this.props.showMine&&!this.props.showShared&&r.a.createElement("div",{className:"page-content-actions"},r.a.createElement(Sa,{folder:this.props.folder})),r.a.createElement(da,{filtered:this.props.showAll||this.props.showMine||this.props.showShared,secrets:this.props.secrets,folders:this.props.folders,isDragging:this.props.isDragging,searchQuery:this.state.searchQuery,endDecrypt:null===q.getState().get("status")})))}}]),t}(n.Component);Oa.defaultProps={folders:new m.a.List,secrets:new m.a.Map,searchQuery:"",showAll:!1,showMine:!1,showShared:!1};var ja=new Ht.DragDropContext(Bt.a)(Object(Ht.DragLayer)(function(e){return{isDragging:e.isDragging()}})(Oa));function Ua(e){var t=e.match.params,a=e.showAll,n=e.showMine,s=e.showShared;if(a){var i=ge.getAllSecrets();return r.a.createElement(ja,{secrets:i,showAll:!0})}if(n){var o=ge.getMySecret();return r.a.createElement(ja,{secrets:o,showMine:!0})}if(s){var c=ge.getSharedSecret();return r.a.createElement(ja,{secrets:c,showShared:!0})}var l=t.path?t.path.split("/"):[],u=new m.a.List(l),d=u.last(),h=ge.getById(d),p=ge.getSecretsInFolder(d);return r.a.createElement(ja,{folder:h,folders:u,secrets:p})}Ua.defaultProps={showAll:!1,showMine:!1,showShared:!1};var Fa=Ua,Ta=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).handleChange=a.handleChange.bind(Object(u.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(u.a)(a)),a.state={shortpass:""},a}return Object(h.a)(t,e),Object(d.a)(t,null,[{key:"getStores",value:function(){return[ee]}},{key:"getPropsFromStores",value:function(){var e=ee.getState();return{errors:e.get("errors"),shown:e.get("showShortLogin"),loading:e.get("loading")}}},{key:"getDerivedStateFromProps",value:function(e){return e.shown?null:{shortpass:""}}}]),Object(d.a)(t,[{key:"handleChange",value:function(e){var t=e.name,a=e.value;this.setState(Object(ve.a)({},t,a))}},{key:"handleSubmit",value:function(){$.activateShortLogin({shortpass:this.state.shortpass})}},{key:"render",value:function(){return r.a.createElement(Ae,{show:this.props.shown,onClose:$.hideShortLogin},r.a.createElement(Ae.Header,null,r.a.createElement("span",{className:"text"},"Trust this device")),r.a.createElement(Ae.Body,null,r.a.createElement(we,{className:"totp-form",id:"totp",onSubmit:this.handleSubmit},r.a.createElement(Te,{label:"Shortpass",name:"shortpass",value:this.state.shortpass,type:"password",onChange:this.handleChange,autoFocus:!0}))),r.a.createElement(Ae.Footer,null,r.a.createElement(Ue,{type:"reset",buttonStyle:"default",onClick:$.hideShortLogin},"Close"),r.a.createElement(Ue,{type:"button",buttonStyle:"primary",onClick:this.handleSubmit,disabled:this.props.loading},"Activate")))}}]),t}(n.Component);Ta.defaultProps={shown:!1,errors:new m.a.Map,loading:!1};var Na=v()(Ta),Pa=a(200),Ra=a.n(Pa),Ia=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).handleChange=a.handleChange.bind(Object(u.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(u.a)(a)),a.state={seed:y.a.Utils.generateSeed(),token:""},a}return Object(h.a)(t,e),Object(d.a)(t,null,[{key:"getStores",value:function(){return[ee]}},{key:"getPropsFromStores",value:function(){var e=ee.getState();return{errors:e.get("errors"),shown:e.get("showQRCode"),loading:e.get("loading")}}},{key:"getDerivedStateFromProps",value:function(e){return e.shown?null:{seed:y.a.Utils.generateSeed(),token:""}}}]),Object(d.a)(t,[{key:"handleChange",value:function(e){var t=e.value.replace(/\s+/g,"").slice(0,6);this.setState({token:t})}},{key:"handleSubmit",value:function(){$.activateTotp(this.state)}},{key:"render",value:function(){return r.a.createElement(Ae,{show:this.props.shown,onClose:$.hideQRCode},r.a.createElement(Ae.Header,null,r.a.createElement("span",{className:"text"},"Activate Two-Factor authentication")),r.a.createElement(Ae.Body,null,r.a.createElement(we,{className:"totp-form",id:"totp",onSubmit:this.handleSubmit},r.a.createElement("div",{className:"totp-form-qrcode"},r.a.createElement(Ra.a,{className:"totp-form-qrcode",value:"otpauth://totp/Secret-in.me?secret=".concat(this.state.seed.b32),size:256})),r.a.createElement(Te,{name:"token",inputProps:{maxLength:6},placeholder:"6-digit code",value:this.state.token,onChange:this.handleChange,onSubmit:this.handleSubmit,error:this.props.errors.get("totp"),autoFocus:!0}))),r.a.createElement(Ae.Footer,null,r.a.createElement(Ue,{type:"reset",buttonStyle:"default",onClick:$.hideQRCode},"Close"),r.a.createElement(Ue,{type:"button",buttonStyle:"primary",onClick:this.handleSubmit,disabled:this.props.loading},"Activate")))}}]),t}(n.Component);Ia.defaultProps={shown:!1,errors:new m.a.Map,loading:!1};var Aa=v()(Ia),La=a(201);function Ma(e){var t=e.username,a=e.rescueCodes.map(function(e,t){return"".concat(t+1,". ").concat(e)}).toArray(),n=["SAVE YOUR BACKUP CODES","Keep these backup codes somewhere safe but accessible.",""].concat(Object(La.a)(a),["","* Codes for user ".concat(t),"* Generated on ".concat(ae()().format("MMM Do, YYYY")),"* You can only use each backup code once.","* Need new codes? Go to ".concat(document.location.href)]).join("\n");return new Blob([n],{type:"text/plain;charset=utf-8;"})}var Da=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).currentUser=q.getCurrentUser(),a}return Object(h.a)(t,e),Object(d.a)(t,null,[{key:"getStores",value:function(){return[ee]}},{key:"getPropsFromStores",value:function(){var e=ee.getState();return{rescueCodes:e.get("rescueCodes"),shown:e.get("showRescueCodes")}}}]),Object(d.a)(t,[{key:"render",value:function(){var e=this.props.rescueCodes,t=this.currentUser.username;return r.a.createElement(Ae,{show:this.props.shown,onClose:$.hideRescueCodes},r.a.createElement(Ae.Header,null,r.a.createElement("span",{className:"text"},"Rescue codes")),r.a.createElement(Ae.Body,null,r.a.createElement("h3",null,"You should view and download your recovery codes and keep them safe."),r.a.createElement("p",null,"If you lose access to your secure token and your code generator, a recovery code is the only way to recover your account."),r.a.createElement("pre",null,e.join(" ")),r.a.createElement("p",null,r.a.createElement("a",{href:window.URL.createObjectURL(Ma({username:t,rescueCodes:e})),download:"Backup-codes-".concat(t,"@secretin.txt")},"Download my codes"))),r.a.createElement(Ae.Footer,null,r.a.createElement(Ue,{type:"reset",buttonStyle:"default",onClick:$.hideRescueCodes},"Close")))}}]),t}(n.Component);Da.defaultProps={shown:!1,rescueCodes:new m.a.List};var _a=v()(Da),za=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).handleChangePassword=a.handleChangePassword.bind(Object(u.a)(a)),a}return Object(h.a)(t,e),Object(d.a)(t,null,[{key:"getStores",value:function(){return[ee]}},{key:"getPropsFromStores",value:function(){var e=ee.getNewPass();return{errors:e.get("error"),shown:e.get("shown"),loading:e.get("loading"),status:e.get("status"),newPass1:e.get("newPass1"),newPass2:e.get("newPass2")}}}]),Object(d.a)(t,[{key:"handleChangePassword",value:function(){$.changePassword({newPass:this.props.newPass1})}},{key:"render",value:function(){return r.a.createElement(Ae,{show:this.props.shown,onClose:$.hideChangePassword},r.a.createElement(Ae.Header,null,r.a.createElement("span",{className:"text"},"Change master password")),"success"!==this.props.status?r.a.createElement(Ae.Body,null,r.a.createElement(Te,{name:"newPass1",label:"New password",value:this.props.newPass1,onChange:$.changeNewPass1,type:"password",disabled:this.props.loading}),this.props.newPass1.length>0&&r.a.createElement("span",{className:"options-changepassword"},r.a.createElement(Te,{name:"newPass2",label:"Retype",value:this.props.newPass2,onChange:$.changeNewPass2,type:"password",disabled:this.props.loading})),r.a.createElement("div",{className:"options-changepassword-infos"},""===this.props.error&&this.props.newPass1.length>0&&this.props.newPass1!==this.props.newPass2&&"Passwords mismatch",""!==this.props.error&&this.props.error)):r.a.createElement(Ae.Body,null,r.a.createElement("div",{className:"options-changepassword-success"},"Success")),r.a.createElement(Ae.Footer,null,r.a.createElement(Ue,{type:"reset",buttonStyle:"default",onClick:$.hideChangePassword},"Close"),this.props.newPass1.length>0&&r.a.createElement(Ue,{type:"button",buttonStyle:"primary",onClick:this.handleChangePassword,disabled:this.props.newPass1!==this.props.newPass2},"Change it")))}}]),t}(n.Component);za.defaultProps={shown:!1,loading:!1,newPass1:"",newPass2:"",error:""};var xa=v()(za),Ba=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).onChange=a.onChange.bind(Object(u.a)(a)),a.id=Object(be.uniqueId)("input_"),a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"onChange",value:function(e){this.props.onChange({name:this.props.name,checked:e.target.checked})}},{key:"render",value:function(){var e=ye()("checkbox",{"checkbox--checked":this.props.checked,"checkbox--unchecked":!this.props.checked});return r.a.createElement("div",{className:"input input--type-checkbox"},r.a.createElement("input",{id:this.id,type:"checkbox",name:this.props.name,checked:this.props.checked,disabled:this.props.disabled,onChange:this.onChange}),r.a.createElement("label",{htmlFor:this.id},r.a.createElement("div",{className:e}),this.props.children))}}]),t}(n.Component);Ba.defaultProps={checked:!1,disabled:!1};var Ha=Ba,Ga=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(d.a)(t,[{key:"onChangeTimeToClose",value:function(e){var t=e.value;$.changeTimeToClose({timeToClose:parseInt(t,10)||0})}},{key:"render",value:function(){var e=this.props.options;return r.a.createElement("div",{className:"page"},r.a.createElement("div",{className:"page-header"},r.a.createElement("div",{className:"breadcrumb"},r.a.createElement(ia,{link:"/options/",icon:"gear",title:"Options"}))),r.a.createElement("div",{className:"page-content options"},r.a.createElement("div",{className:"options-section"},r.a.createElement("h3",{className:"options-section-title"},"Security"),r.a.createElement("div",{className:"options-section-item"},r.a.createElement(Aa,null),r.a.createElement(Ha,{checked:e.get("totp"),onChange:$.toggleTotp,disabled:!q.isOnline()},"Activate two-factor authentication"),e.get("totp")&&r.a.createElement("div",{className:"options-section-subitem"},r.a.createElement(_a,null),r.a.createElement(Ue,{size:"small",buttonStyle:"default",onClick:$.showRescueCodes},"Generate rescue Codes"))),r.a.createElement("div",{className:"options-section-item"},r.a.createElement(Na,null),r.a.createElement(Ha,{checked:e.get("shortLogin"),onChange:$.toggleShortLogin,disabled:!q.isOnline()},"Activate ShortLogin")),r.a.createElement("div",{className:"options-section-item"},r.a.createElement(Ha,{checked:e.get("timeToClose")>0,onChange:$.toggleAutoLogout,disabled:!q.isOnline()},"Activate auto logout"),e.get("timeToClose")>0&&r.a.createElement("div",{className:"options-section-subitem"},"Disconnect me after ",r.a.createElement(Te,{name:"timeToClose",label:"",size:"small",value:e.get("timeToClose"),onChange:this.onChangeTimeToClose,type:"number",inputProps:{min:0,max:60,step:5},debounce:800,disabled:!q.isOnline()}),r.a.createElement("b",null," min")))),r.a.createElement("div",{className:"options-section"},r.a.createElement("div",{className:"options-section-item"},r.a.createElement(xa,null),r.a.createElement(Ue,{type:"button",buttonStyle:"warning",onClick:$.showChangePassword,disabled:!q.isOnline()},"Change master password")))))}}],[{key:"getStores",value:function(){return[ee]}},{key:"getPropsFromStores",value:function(){return{options:ee.getOptions()}}}]),t}(n.Component),Qa=v()(Ga);var Ka=function(){return r.a.createElement("div",{className:"spinner"},r.a.createElement("svg",{className:"spinner-svg",viewBox:"0 0 66 66",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("circle",{className:"spinner-svg-path",fill:"none",strokeWidth:"3",strokeLinecap:"round",cx:"33",cy:"33",r:"30"})))},Ja=function(){function e(t,a){Object(o.a)(this,e),this.func=t,this.total=a,this.status=0}return Object(d.a)(e,[{key:"update",value:function(){this.status+=1,this.func({state:this.status,total:this.total})}}]),e}();function qa(e,t){for(var a="",n={type:"default",fields:[{id:W.a.v4(),type:"text",label:"login",content:""},{id:W.a.v4(),type:"password",label:"password",content:""},{id:W.a.v4(),type:"url",label:"url",content:""}]},r=e.querySelectorAll(":scope > String"),s=0;s<r.length;s+=1){var i=r[s].children[0].textContent,o=r[s].children[1].textContent;"title"===i.toLowerCase()?a=o:"password"===i.toLowerCase()?n.fields[1].content=o:"url"===i.toLowerCase()?n.fields[2].content=o:"username"===i.toLowerCase()?n.fields[0].content=o:Object(be.isEmpty)(o)||n.fields.push({id:W.a.v4(),type:"text",label:i,content:o})}var c="";return j.addSecret(a,n).then(function(e){return c=e,"undefined"!==typeof t?j.addSecretToFolder(c,t):Promise.resolve()})}function Ya(e,t){console.log("".concat(e,"/").concat(t))}function Wa(e,t,a){var n;"undefined"===typeof a?n=[].slice.call(e.querySelectorAll(":scope > Entry")).reduce(function(e,n){return e.then(function(){return qa(n,a).then(function(){t.update()})})},Promise.resolve()):n=Promise.resolve();return n.then(function(){return[].slice.call(e.querySelectorAll(":scope > Group")).reduce(function(e,n){return e.then(function(){return function(e,t,a){var n="",r=e.getElementsByTagName("Name")[0].textContent;return j.addFolder(r).then(function(a){return n=a,[].slice.call(e.querySelectorAll(":scope > Entry")).reduce(function(e,a){return e.then(function(){return qa(a,n).then(function(){t.update()})})},Promise.resolve())}).then(function(){return"undefined"!==typeof a?j.addSecretToFolder(n,a):Promise.resolve()}).then(function(){return Wa(e,t,n)})}(n,t,a)})},Promise.resolve())})}function Va(e,t){console.log("".concat(e,"/").concat(t))}var $a={keepass:{parse:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ya,n=(new DOMParser).parseFromString(e,"application/xml").getElementsByTagName("Root")[0].children[0];return Wa(n,new Ja(a,function e(t){for(var a=t.querySelectorAll(":scope > Entry").length,n=t.querySelectorAll(":scope > Group"),r=0;r<n.length;r+=1)a+=e(n[r]);return a}(n)))},detect:function(e){var t=new DOMParser,a=!1;try{a=1===t.parseFromString(e,"application/xml").getElementsByTagName("KeePassFile").length}catch(n){a=!1}return a},mandatoryFields:{}},secretin:{parse:function(e,t){t.username;var a=t.password,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Va;return j.importDb(a.value,e,n)},detect:function(e){var t=!1;try{var a=JSON.parse(e);t="users"in a&&"secrets"in a}catch(n){t=!1}return t},mandatoryFields:{password:{type:"password",name:"password",value:""}}}},Xa=function(){function e(){Object(o.a)(this,e),this.generateActions("importSecretsProgress","importSecretsSuccess","importSecretsFailure","detectTypeSuccess","detectTypeFailure","defaultStore","changeMandatoryField")}return Object(d.a)(e,[{key:"detectType",value:function(e){var t=this,a=e.file,n=new FileReader;return n.readAsText(a),n.onload=function(e){var a=e.target.result,n=Object(be.findKey)($a,function(e){return e.detect(a)});if("undefined"!==typeof n){var r=$a[n].mandatoryFields;t.detectTypeSuccess({file:a,importType:n,mandatoryFields:r})}else t.detectTypeFailure({error:"Invalid type"})},n}},{key:"importSecrets",value:function(e){var t=this,a=e.file,n=e.type,r=e.mandatoryFields;return function(e){e(),$a[n].parse(a,r.toJS(),function(e){var a=e.state,n=e.total;return t.importSecretsProgress({importStatus:a,importTotal:n})}).then(function(){t.importSecretsSuccess()}).catch(function(e){t.importSecretsFailure({error:e})})}}}]),e}(),Za=N.createActions(Xa),en=new p.Record({importType:"",importing:!1,importStatus:0,importTotal:0,success:!1,file:"",error:"",mandatoryFields:new m.a.Map}),tn=function(){function e(){Object(o.a)(this,e),this.bindActions(Za),this.state=new en}return Object(d.a)(e,[{key:"onImportSecrets",value:function(){this.setState(this.state.merge({importing:!0,success:!1,error:""}))}},{key:"onDetectTypeFailure",value:function(e){var t=e.error;this.setState(this.state.merge({error:t,importType:"",mandatoryFields:new m.a.Map}))}},{key:"onDetectTypeSuccess",value:function(e){var t=e.file,a=e.importType,n=e.mandatoryFields;this.setState(this.state.merge({importType:a,error:"",file:t,mandatoryFields:m.a.fromJS(n)}))}},{key:"onImportSecretsProgress",value:function(e){var t=e.importStatus,a=e.importTotal;this.setState(this.state.merge({importStatus:t,importTotal:a,error:""}))}},{key:"onImportSecretsSuccess",value:function(){this.setState(this.state.merge({importing:!1,success:!0,importType:"",error:"",importStatus:0,importTotal:0,mandatoryFields:new m.a.Map}))}},{key:"onImportSecretsFailure",value:function(e){var t=e.error;this.setState(this.state.merge({importing:!1,success:!1,importType:"",error:t,mandatoryFields:new m.a.Map}))}},{key:"onDefaultStore",value:function(){this.setState(new en)}},{key:"onChangeMandatoryField",value:function(e){var t=e.field,a=e.value;this.setState(this.state.setIn(["mandatoryFields",t.get("name"),"value"],a))}}]),e}(),an=N.createStore(B(tn),"ImportStore"),nn=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).handleFileInputChange=a.handleFileInputChange.bind(Object(u.a)(a)),a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"handleFileInputChange",value:function(e){this.props.onFileChoosen(e.target.files[0])}},{key:"render",value:function(){return this.props.connectDropTarget(r.a.createElement("div",{className:"import-drop-zone"},r.a.createElement(Oe,{id:"upload",size:120}),r.a.createElement("div",{className:"import-drop-zone-label"},r.a.createElement("input",{id:"import-drop-zone-input",className:"import-drop-zone-input",type:"file",onChange:this.handleFileInputChange}),r.a.createElement("label",{htmlFor:"import-drop-zone-input"},"Choose a file"),r.a.createElement("span",null," or drag it here."))))}}]),t}(n.Component);var rn=new Ht.DropTarget(xt.NativeTypes.FILE,{drop:function(e,t){e.onFileChoosen(t.getItem().files[0])}},function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver()}})(nn),sn=new Ht.DragDropContext(Bt.a)(rn),on=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).handleChange=a.handleChange.bind(Object(u.a)(a)),a}return Object(h.a)(t,e),Object(d.a)(t,[{key:"handleChange",value:function(e){var t=e.value,a={field:this.props.field,value:t};this.props.onChange(a)}},{key:"render",value:function(){var e=this;return r.a.createElement(Te,{ref:function(t){e.input=t},label:this.props.field.get("name"),name:this.props.field.get("name"),value:this.props.field.get("value"),onChange:this.handleChange,type:this.props.field.get("type")})}}]),t}(n.Component),cn=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this,t=Object.keys(this.props.mandatoryFields.toJS()),a=[];return t.forEach(function(t){a.push(r.a.createElement(on,{key:t,field:e.props.mandatoryFields.get(t),onChange:Za.changeMandatoryField}))}),r.a.createElement("div",null,a)}}],[{key:"getStores",value:function(){return[an]}},{key:"getPropsFromStores",value:function(){return{mandatoryFields:an.getState().get("mandatoryFields")}}}]),t}(n.Component),ln=v()(cn),un=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).handleFileChoosen=a.handleFileChoosen.bind(Object(u.a)(a)),a.handleStartParsing=a.handleStartParsing.bind(Object(u.a)(a)),a}return Object(h.a)(t,e),Object(d.a)(t,null,[{key:"getStores",value:function(){return[an]}},{key:"getPropsFromStores",value:function(){var e=an.getState();return{error:e.get("error"),importType:e.get("importType"),importing:e.get("importing"),importStatus:e.get("importStatus"),importTotal:e.get("importTotal"),success:e.get("success"),file:e.get("file"),mandatoryFields:e.get("mandatoryFields")}}}]),Object(d.a)(t,[{key:"handleFileChoosen",value:function(e){Za.detectType({file:e})}},{key:"handleStartParsing",value:function(){Za.importSecrets({file:this.props.file,mandatoryFields:this.props.mandatoryFields,type:this.props.importType})}},{key:"shouldComponentUpdate",value:function(e,t){return!0!==this.props.success||e.success!==this.props.success}},{key:"componentDidUpdate",value:function(){this.props.success&&(Q.loadMetadata(),setTimeout(function(){Za.defaultStore()},1500))}},{key:"render",value:function(){return r.a.createElement("div",{className:"page"},r.a.createElement("div",{className:"page-header"},r.a.createElement("div",{className:"breadcrumb"},r.a.createElement(ia,{link:"/import/",icon:"import",title:"Import"}))),r.a.createElement("div",{className:"page-content options"},r.a.createElement("span",null,"Supported type are ",r.a.createElement("i",null,"secret-in"),", ",r.a.createElement("i",null,"keepass")),(this.props.success||this.props.importing)&&(this.props.success&&r.a.createElement("div",{className:"import-progress"},r.a.createElement(Oe,{id:"done",size:120}),r.a.createElement("div",{className:"import-progress-title"},"Done!"))||r.a.createElement("div",{className:"import-progress"},r.a.createElement(Ka,null),0!==this.props.importTotal&&r.a.createElement("div",{className:"import-progress-title"},"Importing... ".concat(this.props.importStatus," / ").concat(this.props.importTotal))))||r.a.createElement(sn,{onFileChoosen:this.handleFileChoosen}),""!==this.props.error&&r.a.createElement("span",null,this.props.error),this.props.mandatoryFields.size>0&&r.a.createElement(ln,{mandatoryFields:this.props.mandatoryFields}),""!==this.props.importType&&r.a.createElement(Ue,{buttonStyle:"primary",className:"button button--style-default button--size-base",onClick:this.handleStartParsing},"Import from ",this.props.importType)))}}]),t}(n.Component),dn=v()(un);var hn=function(){return r.a.createElement("div",{className:"layout"},r.a.createElement(zt,null),r.a.createElement(Ge,null),r.a.createElement("div",{className:"layout-pane"},r.a.createElement(ze.d,null,r.a.createElement(ze.b,{path:"/secrets/all",render:function(e){return r.a.createElement(Fa,Object.assign({},e,{showAll:!0}))}}),r.a.createElement(ze.b,{path:"/secrets/mine",render:function(e){return r.a.createElement(Fa,Object.assign({},e,{showMine:!0}))}}),r.a.createElement(ze.b,{path:"/secrets/shared",render:function(e){return r.a.createElement(Fa,Object.assign({},e,{showShared:!0}))}}),r.a.createElement(ze.b,{path:"/secrets/:path*",render:function(e){return r.a.createElement(Fa,e)}}),r.a.createElement(ze.b,{path:"/settings/",component:Qa}),r.a.createElement(ze.b,{path:"/import/",component:dn}),r.a.createElement(ze.a,{to:"/secrets/"}))))},pn=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(l.a)(t).call(this,e))).disconnectingEvent=null,a.onAppFocus=a.onAppFocus.bind(Object(u.a)(a)),a.onAppBlur=a.onAppBlur.bind(Object(u.a)(a)),window.addEventListener("focus",a.onAppFocus),window.addEventListener("blur",a.onAppBlur),a}return Object(h.a)(t,e),Object(d.a)(t,null,[{key:"getStores",value:function(){return[q,ee,ge]}},{key:"getPropsFromStores",value:function(){var e=q.getState(),t=e.savedUsername,a=e.loading,n=e.errors,r=e.connected,s=e.status;return{secrets:ge.getSecretsInFolder(),options:ee.getOptions(),savedUsername:t,loading:a,connected:r,errors:n,status:s}}}]),Object(d.a)(t,[{key:"componentDidMount",value:function(){j.addEventListener("connectionChange",x.connectionChange)}},{key:"componentWillUnmount",value:function(){j.removeEventListener("connectionChange",x.connectionChange)}},{key:"onAppFocus",value:function(){clearTimeout(this.disconnectingEvent)}},{key:"onAppBlur",value:function(){clearTimeout(this.disconnectingEvent);var e=this.props,t=e.connected,a=e.options;if(t&&a){var n=60*a.get("timeToClose")*1e3;n>0&&(this.disconnectingEvent=setTimeout(x.disconnectUser,n))}}},{key:"render",value:function(){return r.a.createElement(f.a,{basename:""},r.a.createElement("div",{className:"App"},this.props.connected?r.a.createElement(hn,null):r.a.createElement(_e,{savedUsername:this.props.savedUsername,loading:this.props.loading,errors:this.props.errors,status:this.props.status}),r.a.createElement("span",{className:"secretin-version"},"secretin-lib v",y.a.version)))}}]),t}(n.Component),mn=v()(pn),fn=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function gn(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}a(440);var vn=document.getElementById("root");i.a.render(r.a.createElement(mn,null),vn),"undefined"===typeof window.process&&function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("","/service-worker.js");fn?function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):gn(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e):gn(e)})}}()}},[[203,1,2]]]);
//# sourceMappingURL=main.6fd9daea.chunk.js.map